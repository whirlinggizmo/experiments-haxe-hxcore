

# generate the list of all script files
#--cmd echo -n "Building scripts list... "
#--next
#--macro core.macros.ScriptCompiler.generateScriptsList('scripts', 'gen/scripts.hxml')
#--cmd echo "OK"

#--next
#--cmd echo "Building .cpp target (with cppia support)...\n"
#--next

-lib hxcore
-cp src


# enable cppia
-D scriptable 
-cpp out/test

#--dce full

#-D HXCPP_DEBUGGER

# force include some classes that cppia seems to think are here
#--macro include('haxe.Exception')
#--macro include('core.scripting.Script')

# include the scripts as part of the build
#gen/scripts.hxml


--debug
# vscode debugger
-lib hxcpp-debug-server
--dce no

# JIT is enabled by default for cppia (except for emscripten targets)
#-D CPPIA_NO_JIT



--define HAXE_OUTPUT_FILE=ScriptTest
--main ScriptTest

# move the generated export_classes.info to the scripts directory
--cmd mkdir -p scripts
--cmd mv export_classes.info scripts/export_classes.info

# copy the executable to the dist directory
--cmd mkdir -p dist/test
--cmd cp out/test/ScriptTest dist/test/ScriptTest

# create a scripts directory, in case it doesn't exist
--cmd mkdir -p dist/test/scripts

--cmd echo "Compiling Test script..." 
--next

# for testing, we will compile the Test script directly
--cmd haxe -lib hxcore --run hxcore.scripting.ScriptCompiler --target cppia --sourceDir scripts --outputDir dist/test/scripts --script Test

--next

--cmd echo ""
--cmd echo "Build complete."

# launch the binary
# by including the source directory, the scripts will be automatically compiled
--cmd ./dist/test/ScriptTest --sourceDir ../../scripts --scriptDir scripts

# ... or don't include the source directory and the hot compile won't be enabled
#--cmd ./dist/test/ScriptTest -scriptDir scripts

